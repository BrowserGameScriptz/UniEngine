function galaxy_submit(a){if(!isReady){return false}$("#auto").attr("name",a);$("#galaxy_form").submit()}function Phalanx(a,b,c,d){var e=window.open("phalanx.php?galaxy="+a+"&system="+b+"&planet="+c+"&planettype="+d,"","resizable=yes,scrollbars=yes,menubar=no,toolbar=no,width=640,height=480,top=0,left=0");e.focus();return false}function sendShips(a,b,c,d,e,f){if(!isReady){return false}if(BlockFunction!==true){BlockFunction=true;switch(a){case 1:Mission=6;requestPage="ajax/galaxyfleet.php";requestOpt={galaxy:b,system:c,planet:d,type:e,mission:Mission};break;case 2:Mission=8;requestPage="ajax/galaxyfleet.php";requestOpt={galaxy:b,system:c,planet:d,type:e,mission:Mission};break;case 3:Mission=7;requestPage="ajax/galaxyfleet.php";requestOpt={galaxy:b,system:c,planet:d,type:e,mission:Mission};break;case 4:Mission=10;requestPage="ajax/sendmissiles.php";requestOpt={galaxy:b,system:c,planet:d,count:f["count"],target:f["target"]};break;default:Mission=6;requestPage="ajax/galaxyfleet.php";requestOpt={galaxy:b,system:c,planet:d,type:e,mission:Mission};break}$.post(requestPage,requestOpt).complete(function(a,f){if(f=="success"){data=a["responseText"];BlockFunction=false;if(HideTimeout!==false){clearTimeout(HideTimeout)}if(Mission==10){retVals=data.split("|");Code=retVals[0];Update=retVals[1];Missiles=retVals[2];UsedSlots=retVals[3]}else{retVals=data.split("|");Message=retVals[0];Infos=retVals[1];retVals=Infos.split(",");UsedSlots=retVals[0];SpyProbes=retVals[1];Recyclers=retVals[2];Colonizers=retVals[3];retVals=Message.split(";");Code=retVals[0];Update=retVals[1];ShipCount=retVals[2];b=retVals[3];c=retVals[4];d=retVals[5];e=retVals[6]}CodeText=RespCodes[Code];if(CodeText.indexOf("xyz")>=0){CodeText=CodeText.replace("xyz",ShipCount)}if(CodeText.indexOf("replace_target")>=0){if(e==3){AddReplace=" ("+Lang["ajax_moon_sign"]+")"}else{AddReplace=""}ReplaceTextNow=CodeText.replace("replace_target","["+b+":"+c+":"+d+"]"+AddReplace);CodeText=ReplaceTextNow}if(Code.indexOf("600")>=0){textClass="lime"}else{textClass="red"}ShowAjaxInfo(CodeText,textClass);if(Update==1){if(Mission==10){$("#missiles, #missiles2").html(Missiles);El_FlyingFleets.html(UsedSlots)}else{El_FlyingFleets.html(UsedSlots);$("#probes").html(SpyProbes);$("#recyclers").html(Recyclers);$("#colonizers").html(Colonizers)}}}else{var g=0;if(f=="timeout"){g="696"}else{g="698"}ShowAjaxInfo(RespCodes[g],"red",1500)}})}return false}function ShowAjaxInfo(a,b,c){if(HideTimeout!==false){clearTimeout(HideTimeout)}AjaxBox["th"].show(0);AjaxBox["info"].html(a).css("color",b);if(typeof c=="undefined"){c=-1}if(c>=0){HideTimeout=setTimeout(function(){AjaxBox["th"].hide(400);HideTimeout=false},c)}}var BlockFunction=true;var HideTimeout=false;var RespCodes=new Array;var Lang=new Array;var LockGalaxyForm=false;var AjaxBox=false;var isReady=false;var icoTipObj={style:{classes:"tiptip_content"},show:{delay:500},position:{my:"top center",at:"bottom center",adjust:{y:10}}};var El_FlyingFleets=false;$(document).ready(function(){function k(a){a+="";var b=/(\d+)(\d\d\d)/;while(b.test(a)){a=a.replace(b,"$1"+"."+"$2")}return a}function l(a){a+="";a=a.replace(/[^0-9]/g,"");return a}isReady=true;var a=$('[name="galaxy"]');var b=$('[name="system"]');var c=$("#galRows");var d=$("#auto");var e=$("#colonizedCount");var f=$("#lm_msg");var g=$("#MissileForm");var h={galaxy:$('[name="m_galaxy"]',g),system:$('[name="m_system"]',g),planet:$('[name="m_planet"]',g)};var i="0:0:0";var j=$("#MissilePos");AjaxBox={th:$("#fleetstatusrow"),info:$("#ajaxInfoBox")};El_FlyingFleets=$("#slots");$.fn.prettyInputBox=function(){return this.each(function(){if(AllowPrettyInputBox!==undefined&&AllowPrettyInputBox===true){Value=l($(this).val());Value=k(Value);$(this).val(Value)}})};BlockFunction=false;$("#closeMF").click(function(){if(UseAjax===true){i="0:0:0";g.hide("fast")}else{document.location.href=document.location.href.replace("mode=2","mode=3")}});$(document).on("click",".icoMissile",function(){nd();if(UseAjax===true){var a=/galaxy\=([0-9]{1,3}).*?system\=([0-9]{1,3}).*?planet\=([0-9]{1,3})/gi;GetPos=a.exec($(this).attr("href"));var b=GetPos[1]+":"+GetPos[2]+":"+GetPos[3];if(b!=i){h["galaxy"].val(GetPos[1]);h["system"].val(GetPos[2]);h["planet"].val(GetPos[3]);i=GetPos[1]+":"+GetPos[2]+":"+GetPos[3];$("body").animate({scrollTop:0},"fast");if(g.is(":visible")){j.fadeOut("fast",function(){j.html(i);$(this).fadeIn("fast")})}else{j.html(i);g.show("fast")}}else{i="0:0:0";g.hide("fast")}return false}}).on("mouseover",".icoTip",function(){if($(this).data("hasTip")!==true){if($(this).hasClass("icoMissile")){$(this).qtip($.extend(icoTipObj,{content:Lang["icoTip_missile"]}))}else if($(this).hasClass("icoSpy")){$(this).qtip($.extend(icoTipObj,{content:Lang["icoTip_spy"]}))}else if($(this).hasClass("icoMsg")){$(this).qtip($.extend(icoTipObj,{content:Lang["icoTip_msg"]}))}else if($(this).hasClass("icoBuddy")){$(this).qtip($.extend(icoTipObj,{content:Lang["icoTip_buddy"]}))}$(this).data("hasTip",true).trigger("mouseover")}});$("#MissileForm").submit(function(){sendShips(4,h["galaxy"].val(),h["system"].val(),h["planet"].val(),1,{count:$('[name="m_count"]').val(),target:$('[name="m_target"]').val()});return false});$('[name="m_count"]').change(function(){$(this).prettyInputBox()}).keyup(function(){$(this).change()}).keydown(function(){$(this).change()});$("#galaxy_form").submit(function(){if(UseAjax===true){if(LockGalaxyForm===false){LockGalaxyForm=true;if(a.val()==""||isNaN(a.val())){a.val(1)}if(b.val()==""||isNaN(b.val())){b.val(1)}var h=parseInt(a.val(),10);var j=parseInt(b.val(),10);if(typeof d.attr("name")!="undefined"&&d.attr("name")!=""){var k=d.attr("name");switch(k){case"galaxyLeft":if(a.val()==1){a.val(GalaxySettings["maxGal"])}else{a.val(parseInt(a.val(),10)-1)}break;case"galaxyRight":if(a.val()==GalaxySettings["maxGal"]){a.val(1)}else{a.val(parseInt(a.val(),10)+1)}break;case"systemLeft":if(b.val()==1){b.val(GalaxySettings["maxSys"]);if(a.val()==1){a.val(GalaxySettings["maxGal"])}else{a.val(parseInt(a.val(),10)-1)}}else{b.val(parseInt(b.val(),10)-1)}break;case"systemRight":if(b.val()==GalaxySettings["maxSys"]){b.val(1);if(a.val()==GalaxySettings["maxGal"]){a.val(1)}else{a.val(parseInt(a.val(),10)+1)}}else{b.val(parseInt(b.val(),10)+1)}break}}$(document.body).append('<div id="cover" style="position: absolute; background: url(./images/ajax-loader-big.gif) no-repeat center center;"><div style="width: 100%; height: 100%; background: black; opacity: 0.3;"></div></div>');$("#cover").offset(c.offset()).width(c.outerWidth()).height(c.outerHeight());$.get("ajax/galaxy.php",{galaxy:a.val(),system:b.val()}).complete(function(d,k){var l=false;a.val(h);b.val(j);if(k=="success"){d=$.parseJSON(d["responseText"]);if(typeof d["Err"]==="undefined"){if(d["msg"]>0){var m=f.children("#lm_msgc");if(m.length>0){m.html("("+d["msg"]+")")}else{f.addClass("orange").append('<b id="lm_msgc">('+d["msg"]+")</b>")}}else{f.children("#lm_msgc").remove().end().removeClass("orange")}El_FlyingFleets.html(d["fly"]);e.html(d["PC"]);c.html(d["Data"]);a.val(d["G"]);b.val(d["S"]);document.location.hash=a.val()+":"+b.val();i="0:0:0";g.hide("fast")}else{l=true}}if(k!="success"||l===true){var n=0;if(k=="success"){n=d["Err"]}else{if(k=="timeout"){n="696"}else{n="695"}}ShowAjaxInfo(RespCodes[n],"red",1500)}$("#cover").remove();LockGalaxyForm=false})}d.attr("name","");return false}});$(window).resize(function(){if($("#cover").is(":visible")){$("#cover").offset(c.offset()).width(c.outerWidth()).height(c.outerHeight())}});if(UseAjax===true&&typeof document.location.hash!="undefined"&&document.location.hash!=""){var m=document.location.hash.replace("#","").split(":");if(a.val()!=m[0]||b.val()!=m[1]){a.val(m[0]);b.val(m[1]);$("#galaxy_form").submit()}}})